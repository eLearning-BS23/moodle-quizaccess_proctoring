define("quizaccess_proctoring/validateAdminUploadedImage",["jquery","core/ajax","core/notification","core/str"],(function($,Ajax,Notification,Str){let notificationShown=0;const clearPreviousNotifications=()=>{try{let alerts=document.getElementsByClassName("alert");alerts.length>0&&(Array.from(alerts).forEach((alert=>{alert.style.display="none"})),notificationShown=0)}catch(error){Notification.exception(error)}},displayNotification=(message,type)=>{Notification.addNotification({message:message,type:type})},detectface=async(input,croppedImage)=>{const output=await faceapi.detectAllFaces(input);if(output.length>0){let detections=output[0].box;await(async(imageRef,box,croppedImage)=>{const regionsToExtract=[new faceapi.Rect(box.x,box.y,box.width,box.height)];let faceImages=await faceapi.extractFaces(imageRef,regionsToExtract);faceImages.length>0&&faceImages.forEach((cnv=>{croppedImage.src=cnv.toDataURL()}))})(input,detections,croppedImage)}};return{async setup(modelurl){await faceapi.nets.ssdMobilenetv1.loadFromUri(modelurl),$("#fitem_id_user_photo").append('<img id="cropimg" style="display:none;"/><img id="previewimg" style="display:none;" height="auto"width="auto"/>');let previewImage,submitBtn=document.getElementById("id_submitbutton"),croppedImage=$("#cropimg");return submitBtn&&(submitBtn.disabled=!0),setInterval((async function(){let preview=document.getElementsByClassName("realpreview");const strings=await async function(){const stringkeys=[{key:"facefound",component:"quizaccess_proctoring"},{key:"facenotfound",component:"quizaccess_proctoring"}];try{const strings=await Str.get_strings(stringkeys);return{facefound:strings[0],facenotfound:strings[1]}}catch(error){Notification.exception(error)}}();if(preview.length>0){previewImage=document.getElementById("previewimg");const splitArray=preview[0].src.split("?");if(previewImage.src===splitArray[0])return;if(previewImage.src=splitArray[0],await detectface(previewImage,croppedImage),croppedImage.src){submitBtn&&(submitBtn.disabled=!1),clearPreviousNotifications(),0==notificationShown&&(displayNotification(strings.facefound,"success"),notificationShown=1);let faceImageField=document.querySelector('[name="face_image"]');faceImageField&&faceImageField.setAttribute("value",croppedImage.src),croppedImage.src=null}else{clearPreviousNotifications(),0==notificationShown&&(displayNotification(strings.facenotfound,"error"),notificationShown=1,submitBtn.disabled=!0),croppedImage.src=null;let faceImageField=document.querySelector('[name="face_image"]');faceImageField&&faceImageField.setAttribute("value",croppedImage.src)}}else submitBtn&&(submitBtn.disabled=!0)}),1e3),!0}}}));

//# sourceMappingURL=validateAdminUploadedImage.min.js.map