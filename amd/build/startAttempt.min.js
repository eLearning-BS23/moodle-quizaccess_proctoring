define("quizaccess_proctoring/startAttempt",["jquery","core/ajax","core/notification","core/str"],(function($,Ajax,Notification,Str){const detectface=async(input,croppedImage)=>{const output=await faceapi.detectAllFaces(input);if(0!==output.length){let detections=output[0].box;await(async(imageRef,box,croppedImage)=>{const regionsToExtract=[new faceapi.Rect(box.x,box.y,box.width,box.height)];let faceImages=await faceapi.extractFaces(imageRef,regionsToExtract);0!==faceImages.length&&faceImages.forEach((cnv=>{croppedImage.src=cnv.toDataURL()}))})(input,detections,croppedImage)}};return{setup:async function(props,modelurl){const strings=await async function(){const stringkeys=[{key:"facematched",component:"quizaccess_proctoring"},{key:"photonotuploaded",component:"quizaccess_proctoring"},{key:"invalidapi",component:"quizaccess_proctoring"},{key:"facenotmatched",component:"quizaccess_proctoring"},{key:"wrong_during_taking_image",component:"quizaccess_proctoring"}];try{const strings=await Str.get_strings(stringkeys);return{facematched:strings[0],photonotuploaded:strings[1],invalidapi:strings[2],facenotmatched:strings[3],wrongduringtakingimage:strings[4]}}catch(error){return Notification.exception(error),{}}}();return null!==modelurl&&await faceapi.nets.ssdMobilenetv1.loadFromUri(modelurl),$("#fcvalidate").append('<img id="validate-cropimg" style="display: none;" src="" alt=""/>'),$("#fcvalidate").click((async function(event){event.preventDefault();const photo=document.getElementById("photo"),canvas=document.getElementById("canvas"),video=document.getElementById("video"),context=canvas.getContext("2d");canvas.width=props.imagewidth,canvas.height=canvas.width/(4/3),context.drawImage(video,0,0,canvas.width,canvas.height);var data=canvas.toDataURL("image/png");photo.setAttribute("src",data);const courseid=document.getElementById("courseidval").value,cmid=document.getElementById("cmidval").value,profileimage=document.getElementById("profileimage").value;let faceFound,faceImage,croppedImage=$("#validate-cropimg");null!==modelurl&&await detectface(photo,croppedImage),croppedImage.src?(faceFound=1,faceImage=croppedImage.src):(faceFound=0,faceImage="");const request={methodname:"quizaccess_proctoring_validate_face",args:{courseid:courseid,cmid:cmid,profileimage:profileimage,webcampicture:data,parenttype:"camshot_image",faceimage:faceImage,facefound:faceFound}};document.getElementById("loading_spinner").style.display="block",Ajax.call([request])[0].done((function(res){if(res.warnings.length<1){document.getElementById("loading_spinner").style.display="none";var status=res.status;"success"===status?($("#video").css("border","10px solid green"),$("#face_validation_result").html('<span style="color: green">'.concat(strings.facematched,"</span>")),document.getElementById("fcvalidate").style.display="none",$("#form_activate").css("visibility","visible")):"photonotuploaded"===status?($("#video").css("border","10px solid red"),$("#face_validation_result").html('<span style="color: red">'.concat(strings.photonotuploaded,"</span>"))):"invalidApi"===status?($("#video").css("border","10px solid red"),$("#face_validation_result").html('<span style="color: red">'.concat(strings.invalidapi,"</span>"))):($("#video").css("border","10px solid red"),$("#face_validation_result").html('<span style="color: red">'.concat(strings.facenotmatched,"</span>")))}else document.getElementById("loading_spinner").style.display="none",video&&Notification.addNotification({message:strings.wrongduringtakingimage,type:"error"})})).fail(Notification.exception)})),!0}}}));

//# sourceMappingURL=startAttempt.min.js.map