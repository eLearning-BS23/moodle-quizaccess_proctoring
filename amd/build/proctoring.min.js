var isCameraAllowed=!1;define ("quizaccess_proctoring/proctoring",["jquery","core/ajax","core/notification"],function(a,b,c){a("#id_submitbutton").prop("disabled",!0);a(function(){a("#id_submitbutton").prop("disabled",!0);a("#id_proctoring").on("change",function(){if(this.checked&&isCameraAllowed){a("#id_submitbutton").prop("disabled",!1)}else{a("#id_submitbutton").prop("disabled",!0)}})});function d(){a(".mod_quiz-next-nav").prop("disabled",!0);a(".submitbtns").html("<p class=\"text text-red red\">You need to enable web camera before submitting this quiz!</p>")}var e=3e4;return{setup:function setup(f){e=f.camshotdelay;if(null!==document.getElementById("page-mod-quiz-summary")&&document.getElementById("page-mod-quiz-summary").innerHTML.length){return!1}if(null!==document.getElementById("page-mod-quiz-review")&&document.getElementById("page-mod-quiz-review").innerHTML.length){return!1}var g=f.image_width,h=0,i=!1,j=null;a("#mod_quiz_navblock").append("<div class=\"card-body p-3\"><h3 class=\"no text-left\">Webcam</h3> <br/><video id=\"video\">Video stream not available.</video><canvas id=\"canvas\" style=\"display:none;\"></canvas><div class=\"output\" style=\"display:none;\"><img id=\"photo\" alt=\"The picture will appear in this box.\"/></div></div>");var k=document.getElementById("video"),l=document.getElementById("canvas"),m=document.getElementById("photo"),n=function(){var a=l.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,l.width,l.height);j=l.toDataURL("image/png");m.setAttribute("src",j)},o=function(){var a=l.getContext("2d");if(g&&h){l.width=g;l.height=h;a.drawImage(k,0,0,g,h);j=l.toDataURL("image/png");m.setAttribute("src",j);f.webcampicture=j;var d={courseid:f.courseid,screenshotid:f.id,quizid:f.quizid,webcampicture:j,imagetype:1};b.call([{methodname:"quizaccess_proctoring_send_camshot",args:d}])[0].done(function(a){if(!(1>a.warnings.length)){if(k){c.addNotification({message:"Something went wrong during taking the image.",type:"error"})}}}).fail(c.exception)}else{n()}};navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){k.srcObject=a;k.play();isCameraAllowed=!0}).catch(function(){d()});if(k){k.addEventListener("canplay",function(){if(!i){h=k.videoHeight/(k.videoWidth/g);if(isNaN(h)){h=g/(4/3)}k.setAttribute("width",g);k.setAttribute("height",h);l.setAttribute("width",g);l.setAttribute("height",h);i=!0}},!1);k.addEventListener("click",function(a){o();a.preventDefault()},!1);setTimeout(o,3000);setInterval(o,e)}else{d()}return!0},init:function init(a){var h=0,i=!1,j=null,k=null,l=null,m=null;function e(){j=document.getElementById("video");k=document.getElementById("canvas");l=document.getElementById("photo");if(j){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(a){j.srcObject=a;j.play();isCameraAllowed=!0}).catch(function(){c.addNotification({message:a.allowcamerawarning,type:"warning"});d()});j.addEventListener("canplay",function(){if(!i){h=j.videoHeight/(j.videoWidth/width);if(isNaN(h)){h=width/(4/3)}j.setAttribute("width",width);j.setAttribute("height",h);k.setAttribute("width",width);k.setAttribute("height",h);i=!0}},!1);j.addEventListener("click",function(a){g();a.preventDefault()},!1)}else{d()}f()}function f(){if(isCameraAllowed){var a=k.getContext("2d");a.fillStyle="#AAA";a.fillRect(0,0,k.width,k.height);m=k.toDataURL("image/png");l.setAttribute("src",m)}else{d()}}function g(){var d=k.getContext("2d");if(width&&h){k.width=width;k.height=h;d.drawImage(j,0,0,width,h);m=k.toDataURL("image/png");l.setAttribute("src",m);var e={courseid:a.courseid,screenshotid:a.id,quizid:a.quizid,webcampicture:m,imagetype:1};b.call([{methodname:"quizaccess_proctoring_send_camshot",args:e}])[0].done(function(a){if(!(1>a.warnings.length)){c.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}}).fail(c.exception)}else{f()}}e();return m}}});
//# sourceMappingURL=proctoring.min.js.map
